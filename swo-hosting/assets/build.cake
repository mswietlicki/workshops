#reference "Microsoft.CSharp.dll"

System.IO.Directory.SetCurrentDirectory("..\\");
#load "..\\tools\\Pyra.Cake.Automation\\Features\\config.cake"
#load "..\\tools\\Pyra.Cake.Automation\\Features\\aspnetcore.cake"
#load "..\\tools\\Pyra.Cake.Automation\\Features\\webjob.cake"
#load "..\\tools\\Pyra.Cake.Automation\\Features\\azure.cake"
//////////////////////////////////////////////////////////////////////
// ARGUMENTS
//////////////////////////////////////////////////////////////////////

var target = Argument("target", "Default");

//////////////////////////////////////////////////////////////////////
// PREPARATION
//////////////////////////////////////////////////////////////////////

var buildDir = Directory(@"build");

//////////////////////////////////////////////////////////////////////
// TASKS
//////////////////////////////////////////////////////////////////////

Task("Build")
    .IsDependentOn("Load-configuration")
    .IsDependentOn("Clean")
    .IsDependentOn("Restore")
    .IsDependentOn("Build-Projects");

Task("Run-UnitTests")
    .IsDependentOn("Build")
    .IsDependentOn("Run-DotNetUnitTests");

Task("Publish")
    .IsDependentOn("Build")
    .IsDependentOn("Run-UnitTests")
    .IsDependentOn("Publish-WebApp");

//////////////////////////////////////////////////////////////////////
// TASK TARGETS
//////////////////////////////////////////////////////////////////////

Task("Default")
    .IsDependentOn("Run-UnitTests");

//////////////////////////////////////////////////////////////////////
// EXECUTION
//////////////////////////////////////////////////////////////////////

RunTarget(target);
