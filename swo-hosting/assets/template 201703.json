{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "servicePlan": {
            "type": "string"
        },
        "servicePlanGroup": {
            "type": "string"
        },
        "serviceBus": {
            "type": "string"
        },
        "webApi": {
            "type": "string"
        },
        "internalWebApi": {
            "type": "string"
        },
        "pyracloudSSLThumbprint": {
            "type": "string"
        },
        "ASPNETCORE_ENVIRONMENT": {
            "type": "string"
        },
        "WEBSITE_LOAD_CERTIFICATES": {
            "type": "string"
        }
    },
    "variables": {},
    "resources": [
        {
            "type": "Microsoft.ServiceBus/namespaces",
            "sku": {
                "name": "Standard",
                "tier": "Standard"
            },
            "kind": "Messaging",
            "name": "[parameters('serviceBus')]",
            "apiVersion": "2015-08-01",
            "location": "West Europe",
            "tags": {},
            "properties": {
                "provisioningState": "Succeeded",
                "status": "Active",
                "createdAt": "2016-10-18T11:35:50.727Z",
                "serviceBusEndpoint": "[concat('https://', parameters('serviceBus'),'.servicebus.windows.net:443/')]",
                "enabled": true,
                "updatedAt": "2016-10-18T11:36:15.89Z"
            },
            "resources": [],
            "dependsOn": []
        },
        {
            "type": "Microsoft.ServiceBus/namespaces/AuthorizationRules",
            "name": "[concat(parameters('serviceBus'),'/RootManageSharedAccessKey')]",
            "apiVersion": "2015-08-01",
            "properties": {
                "rights": [
                    "Listen",
                    "Manage",
                    "Send"
                ]
            },
            "resources": [],
            "dependsOn": [
                "[resourceId('Microsoft.ServiceBus/namespaces', parameters('serviceBus'))]"
            ]
        },
        {
            "comments": "",
            "type": "Microsoft.Web/sites",
            "name": "[parameters('webApi')]",
            "apiVersion": "2015-08-01",
            "location": "[resourceGroup().location]",
            "tags": {},
            "properties": {
                "name": "[parameters('webApi')]",
                "hostNames": [
                    "[concat(parameters('webApi'),'.azurewebsites.net')]"
                ],
                "enabledHostNames": [
                    "[concat(parameters('webApi'),'.azurewebsites.net')]",
                    "[concat(parameters('webApi'),'.scm.azurewebsites.net')]"
                ],
                "hostNameSslStates": [
                    {
                        "name": "[concat(parameters('webApi'),'.azurewebsites.net')]",
                        "sslState": 0,
                        "thumbprint": null,
                        "ipBasedSslState": 0
                    },
                    {
                        "name": "[concat(parameters('webApi'),'.scm.azurewebsites.net')]",
                        "sslState": 0,
                        "thumbprint": null,
                        "ipBasedSslState": 0
                    }
                ],
                "serverFarmId": "[resourceId(parameters('servicePlanGroup'),'Microsoft.Web/serverfarms',parameters('servicePlan'))]",
                "siteConfig": {
                    "phpVersion": "off",
                    "alwaysOn": "true",
                    "webSocketsEnabled": "true",
                    "appSettings": [
                        {
                            "name": "ASPNETCORE_ENVIRONMENT",
                            "value": "[parameters('ASPNETCORE_ENVIRONMENT')]"
                        },
                        {
                            "Name": "WEBSITE_LOAD_CERTIFICATES",
                            "Value": "[parameters('WEBSITE_LOAD_CERTIFICATES')]"
                        }
                    ]
                }
            },
            "resources": [
                {
                    "apiVersion": "2015-04-01",
                    "name": "web",
                    "type": "config",
                    "dependsOn": [
                        "[resourceId('Microsoft.Web/Sites', parameters('webApi'))]"
                    ],
                    "properties": {
                        "cors": {
                            "allowedOrigins": [
                                "*"
                            ]
                        },
                        "apiDefinition": {
                            "url": "[concat('https://', parameters('webApi'), '.azurewebsites.net/swagger/docs/v1')]"
                        }
                    }
                }
            ],
            "dependsOn": []
        },
        {
            "comments": "",
            "type": "Microsoft.Web/sites",
            "name": "[parameters('internalWebApi')]",
            "apiVersion": "2015-08-01",
            "location": "[resourceGroup().location]",
            "tags": {},
            "properties": {
                "name": "[parameters('internalWebApi')]",
                "hostNames": [
                    "[concat(parameters('internalWebApi'),'.azurewebsites.net')]"
                ],
                "enabledHostNames": [
                    "[concat(parameters('internalWebApi'),'.azurewebsites.net')]",
                    "[concat(parameters('internalWebApi'),'.scm.azurewebsites.net')]"
                ],
                "hostNameSslStates": [
                    {
                        "name": "[concat(parameters('internalWebApi'),'.azurewebsites.net')]",
                        "sslState": 0,
                        "thumbprint": null,
                        "ipBasedSslState": 0
                    },
                    {
                        "name": "[concat(parameters('internalWebApi'),'.scm.azurewebsites.net')]",
                        "sslState": 0,
                        "thumbprint": null,
                        "ipBasedSslState": 0
                    }
                ],
                "serverFarmId": "[resourceId(parameters('servicePlanGroup'),'Microsoft.Web/serverfarms',parameters('servicePlan'))]",
                "siteConfig": {
                    "phpVersion": "off",
                    "alwaysOn": "true",
                    "webSocketsEnabled": "true",
                    "appSettings": [
                        {
                            "name": "ASPNETCORE_ENVIRONMENT",
                            "value": "[parameters('ASPNETCORE_ENVIRONMENT')]"
                        },
                        {
                            "Name": "WEBSITE_LOAD_CERTIFICATES",
                            "Value": "[parameters('WEBSITE_LOAD_CERTIFICATES')]"
                        }
                    ]
                }
            },
            "resources": [
                {
                    "apiVersion": "2015-04-01",
                    "name": "web",
                    "type": "config",
                    "dependsOn": [
                        "[resourceId('Microsoft.Web/Sites', parameters('internalWebApi'))]"
                    ],
                    "properties": {
                        "cors": {
                            "allowedOrigins": [
                                "*"
                            ]
                        },
                        "apiDefinition": {
                            "url": "[concat('https://', parameters('internalWebApi'), '.azurewebsites.net/swagger/docs/v1')]"
                        }
                    }
                }
            ],
            "dependsOn": []
        }
    ]
}